<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:TableSpec.Desktop.ViewModels"
             xmlns:domain="using:TableSpec.Domain.Entities"
             xmlns:converters="using:TableSpec.Desktop.Converters"
             xmlns:lvc="using:LiveChartsCore.SkiaSharpView.Avalonia"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="600"
             x:Class="TableSpec.Desktop.Views.HealthMonitoringDocumentView"
             x:DataType="vm:HealthMonitoringDocumentViewModel">

    <UserControl.Resources>
        <converters:BoolToYesNoConverter x:Key="BoolToYesNoConverter"/>
        <converters:HealthStatusColorConverter x:Key="HealthStatusColorConverter"/>
        <converters:HealthStatusIconConverter x:Key="HealthStatusIconConverter"/>
        <converters:OverallStatusBackgroundConverter x:Key="OverallStatusBackgroundConverter"/>
        <converters:InstallStatusColorConverter x:Key="InstallStatusColorConverter"/>
    </UserControl.Resources>

    <Design.DataContext>
        <vm:HealthMonitoringDocumentViewModel/>
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*,Auto">
        <!-- å·¥å…·åˆ— -->
        <Border Grid.Row="0" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}" Padding="10,8">
            <StackPanel Orientation="Horizontal" Spacing="10">
                <Button Command="{Binding SwitchToSetupCommand}">
                    <StackPanel Orientation="Horizontal" Spacing="5">
                        <TextBlock Text="âš™ï¸" FontSize="14"/>
                        <TextBlock Text="è¨­å®š"/>
                    </StackPanel>
                </Button>
                <Button Command="{Binding SwitchToDashboardCommand}" IsEnabled="{Binding IsInstalled}">
                    <StackPanel Orientation="Horizontal" Spacing="5">
                        <TextBlock Text="ðŸ“Š" FontSize="14"/>
                        <TextBlock Text="çœ‹æ¿"/>
                    </StackPanel>
                </Button>
                <Separator/>
                <Button Command="{Binding RefreshCommand}">
                    <StackPanel Orientation="Horizontal" Spacing="5">
                        <TextBlock Text="ðŸ”ƒ" FontSize="14"/>
                        <TextBlock Text="é‡æ–°æ•´ç†"/>
                    </StackPanel>
                </Button>
                <Button Command="{Binding ExecuteHealthCheckCommand}" IsEnabled="{Binding IsInstalled}">
                    <StackPanel Orientation="Horizontal" Spacing="5">
                        <TextBlock Text="ðŸ©º" FontSize="14"/>
                        <TextBlock Text="åŸ·è¡Œå¥åº·æª¢æŸ¥"/>
                    </StackPanel>
                </Button>
                <Separator/>
                <Button Command="{Binding CancelOperationCommand}" IsVisible="{Binding IsProcessing}">
                    <StackPanel Orientation="Horizontal" Spacing="5">
                        <TextBlock Text="âœ•" FontSize="14"/>
                        <TextBlock Text="å–æ¶ˆ"/>
                    </StackPanel>
                </Button>
                <ProgressBar IsIndeterminate="True" Width="100"
                             IsVisible="{Binding IsProcessing}"/>
            </StackPanel>
        </Border>

        <!-- ä¸»è¦å…§å®¹å€ -->
        <Grid Grid.Row="1">
            <!-- è¨­å®šé¢æ¿ -->
            <ScrollViewer IsVisible="{Binding ShowSetupPanel}">
                <StackPanel Spacing="15" Margin="15">
                    <!-- å®‰è£ç‹€æ…‹ -->
                    <Border Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                            CornerRadius="5" Padding="15">
                        <StackPanel Spacing="10">
                            <TextBlock Text="å®‰è£ç‹€æ…‹" FontWeight="Bold" FontSize="14"/>
                            <Grid ColumnDefinitions="Auto,Auto,Auto,Auto" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto">
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="DBA è³‡æ–™åº«ï¼š" Margin="0,0,10,5"/>
                                <TextBlock Grid.Row="0" Grid.Column="1"
                                           Text="{Binding InstallStatus.DatabaseExists, Converter={StaticResource BoolToYesNoConverter}}"
                                           Foreground="{Binding InstallStatus.DatabaseExists, Converter={StaticResource InstallStatusColorConverter}}"
                                           Margin="0,0,30,5"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="ç›£æŽ§è¨˜éŒ„è¡¨ï¼š" Margin="0,0,10,5"/>
                                <TextBlock Grid.Row="1" Grid.Column="1"
                                           Text="{Binding InstallStatus.HealthLogTableExists, Converter={StaticResource BoolToYesNoConverter}}"
                                           Foreground="{Binding InstallStatus.HealthLogTableExists, Converter={StaticResource InstallStatusColorConverter}}"
                                           Margin="0,0,30,5"/>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="ç›£æŽ§é¡žåˆ¥è¡¨ï¼š" Margin="0,0,10,5"/>
                                <TextBlock Grid.Row="2" Grid.Column="1"
                                           Text="{Binding InstallStatus.CategoriesTableExists, Converter={StaticResource BoolToYesNoConverter}}"
                                           Foreground="{Binding InstallStatus.CategoriesTableExists, Converter={StaticResource InstallStatusColorConverter}}"
                                           Margin="0,0,30,5"/>

                                <TextBlock Grid.Row="3" Grid.Column="0" Text="ä¸»ç›£æŽ§ç¨‹åºï¼š" Margin="0,0,10,5"/>
                                <TextBlock Grid.Row="3" Grid.Column="1"
                                           Text="{Binding InstallStatus.MasterProcedureExists, Converter={StaticResource BoolToYesNoConverter}}"
                                           Foreground="{Binding InstallStatus.MasterProcedureExists, Converter={StaticResource InstallStatusColorConverter}}"
                                           Margin="0,0,30,5"/>

                                <TextBlock Grid.Row="4" Grid.Column="0" Text="ç›£æŽ§è¦–åœ–ï¼š" Margin="0,0,10,5"/>
                                <TextBlock Grid.Row="4" Grid.Column="1"
                                           Text="{Binding InstallStatus.ViewsExist, Converter={StaticResource BoolToYesNoConverter}}"
                                           Foreground="{Binding InstallStatus.ViewsExist, Converter={StaticResource InstallStatusColorConverter}}"
                                           Margin="0,0,30,5"/>

                                <TextBlock Grid.Row="5" Grid.Column="0" Text="SQL Agent ä½œæ¥­ï¼š" Margin="0,0,10,5"/>
                                <TextBlock Grid.Row="5" Grid.Column="1"
                                           Text="{Binding InstallStatus.AgentJobsExist, Converter={StaticResource BoolToYesNoConverter}}"
                                           Foreground="{Binding InstallStatus.AgentJobsExist, Converter={StaticResource InstallStatusColorConverter}}"
                                           Margin="0,0,30,5"/>

                                <TextBlock Grid.Row="6" Grid.Column="0" Text="ç›£æŽ§è¨˜éŒ„æ•¸ï¼š" Margin="0,0,10,0"/>
                                <TextBlock Grid.Row="6" Grid.Column="1"
                                           Text="{Binding InstallStatus.LogCount, StringFormat={}{0:N0} ç­†}"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- å®‰è£/ç§»é™¤æ“ä½œ -->
                    <Border Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                            CornerRadius="5" Padding="15">
                        <StackPanel Spacing="15">
                            <TextBlock Text="æ“ä½œ" FontWeight="Bold" FontSize="14"/>

                            <!-- å®‰è£æŒ‰éˆ• -->
                            <StackPanel Spacing="10" IsVisible="{Binding !IsInstalled}">
                                <TextBlock Text="å°šæœªå®‰è£å¥åº·ç›£æŽ§ç³»çµ±ï¼Œé»žæ“Šä¸‹æ–¹æŒ‰éˆ•é–‹å§‹å®‰è£ã€‚"/>
                                <TextBlock Text="å®‰è£å°‡æœƒï¼š" FontWeight="SemiBold"/>
                                <TextBlock Text="â€¢ å»ºç«‹ DBA è³‡æ–™åº«" Margin="10,0,0,0"/>
                                <TextBlock Text="â€¢ å»ºç«‹ç›£æŽ§è³‡æ–™è¡¨å’Œè¦–åœ–" Margin="10,0,0,0"/>
                                <TextBlock Text="â€¢ å»ºç«‹ç›£æŽ§é å­˜ç¨‹åº" Margin="10,0,0,0"/>
                                <TextBlock Text="â€¢ å»ºç«‹ SQL Agent æŽ’ç¨‹ä½œæ¥­ï¼ˆæ¯å°æ™‚åŸ·è¡Œï¼‰" Margin="10,0,0,0"/>
                                <Button Content="å®‰è£å¥åº·ç›£æŽ§ç³»çµ±" Command="{Binding InstallCommand}"
                                        HorizontalAlignment="Left" Padding="20,10"/>
                            </StackPanel>

                            <!-- ç§»é™¤é¸é … -->
                            <StackPanel Spacing="10" IsVisible="{Binding InstallStatus.IsPartiallyInstalled}">
                                <TextBlock Text="ç§»é™¤é¸é …" FontWeight="SemiBold"/>
                                <CheckBox IsChecked="{Binding KeepHistoryData}" Content="ä¿ç•™æ­·å²ç›£æŽ§è³‡æ–™"/>
                                <CheckBox IsChecked="{Binding RemoveJobsOnly}" Content="åªç§»é™¤ SQL Agent ä½œæ¥­"/>
                                <Button Content="ç§»é™¤å¥åº·ç›£æŽ§ç³»çµ±" Command="{Binding UninstallCommand}"
                                        HorizontalAlignment="Left" Padding="20,10"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- é€²åº¦ -->
                    <Border Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                            CornerRadius="5" Padding="15"
                            IsVisible="{Binding IsProcessing}">
                        <StackPanel Spacing="10">
                            <TextBlock Text="é€²åº¦" FontWeight="Bold"/>
                            <ProgressBar Minimum="0" Maximum="100" Value="{Binding ProgressPercentage}"
                                         ShowProgressText="True"/>
                            <TextBlock Text="{Binding ProgressMessage}"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>

            <!-- çœ‹æ¿é¢æ¿ -->
            <TabControl IsVisible="{Binding ShowDashboard}" Margin="10"
                        SelectedIndex="{Binding SelectedTabIndex}">

                <!-- ç¸½è¦½åˆ†é  -->
                <TabItem Header="ç¸½è¦½">
                    <ScrollViewer>
                        <StackPanel Spacing="15" Margin="10">
                            <!-- ç‹€æ…‹å¡ç‰‡ -->
                            <Border Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                                    CornerRadius="5" Padding="10" Margin="0,0,0,5">
                                <StackPanel Spacing="5">
                                    <TextBlock Text="ç³»çµ±ç‹€æ…‹æ‘˜è¦" FontWeight="Bold" FontSize="14"/>
                                    <TextBlock TextWrapping="Wrap" FontSize="11" Foreground="Gray">
                                        <Run Text="â€¢ é¡¯ç¤ºã€Œæœ€æ–°ä¸€æ¬¡å¥åº·æª¢æŸ¥ã€çš„çµæžœï¼ˆéžæ­·å²çµ±è¨ˆï¼‰"/>
                                    </TextBlock>
                                    <TextBlock TextWrapping="Wrap" FontSize="11" Foreground="Gray">
                                        <Run Text="â€¢ æ•¸å­—ä»£è¡¨è©²é¡žåž‹æœ‰å¹¾å€‹ã€ŒæŒ‡æ¨™ã€è™•æ–¼å„ç‹€æ…‹ï¼ˆä¾‹å¦‚ Memory æœ‰ 2 å€‹æŒ‡æ¨™ï¼šMemory Usage % å’Œ Page Life Expectancyï¼‰"/>
                                    </TextBlock>
                                    <TextBlock TextWrapping="Wrap" FontSize="11" Foreground="Gray">
                                        <Run Text="â€¢ é»žæ“Šå¡ç‰‡å¯æŸ¥çœ‹è©²é¡žåž‹çš„ã€Œæ­·å²å‘Šè­¦è¨˜éŒ„ã€ï¼ˆåƒ…é¡¯ç¤º WARNING å’Œ CRITICALï¼‰"/>
                                    </TextBlock>
                                </StackPanel>
                            </Border>
                            <ItemsControl ItemsSource="{Binding StatusSummaries}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel Orientation="Horizontal"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate x:DataType="domain:HealthStatusSummary">
                                        <Button Command="{Binding $parent[ItemsControl].((vm:HealthMonitoringDocumentViewModel)DataContext).NavigateToAlertsCommand}"
                                                CommandParameter="{Binding CheckType}"
                                                Padding="0" Margin="5" Cursor="Hand">
                                            <Button.Template>
                                                <ControlTemplate>
                                                    <Border Background="{Binding OverallStatus, Converter={StaticResource OverallStatusBackgroundConverter}}"
                                                            BorderBrush="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
                                                            BorderThickness="1" CornerRadius="5" Padding="15" Width="180"
                                                            x:Name="CardBorder">
                                                        <StackPanel Spacing="8">
                                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                                <TextBlock Text="{Binding OverallStatus, Converter={StaticResource HealthStatusIconConverter}}"
                                                                           FontSize="18"
                                                                           Foreground="{Binding OverallStatus, Converter={StaticResource HealthStatusColorConverter}}"/>
                                                                <TextBlock Text="{Binding CheckType}" FontWeight="Bold" FontSize="14"/>
                                                            </StackPanel>
                                                            <Grid ColumnDefinitions="*,*,*">
                                                                <StackPanel Grid.Column="0" HorizontalAlignment="Center"
                                                                            ToolTip.Tip="ç‹€æ…‹ç‚º OK çš„æª¢æŸ¥é …ç›®æ•¸é‡">
                                                                    <TextBlock Text="{Binding OkCount}" HorizontalAlignment="Center"
                                                                               FontSize="16" FontWeight="Bold" Foreground="Green"/>
                                                                    <TextBlock Text="æ­£å¸¸" HorizontalAlignment="Center" FontSize="11"/>
                                                                </StackPanel>
                                                                <StackPanel Grid.Column="1" HorizontalAlignment="Center"
                                                                            ToolTip.Tip="ç‹€æ…‹ç‚º WARNING çš„æª¢æŸ¥é …ç›®æ•¸é‡ï¼ˆè¶…éŽè­¦å‘Šé–¾å€¼ï¼‰">
                                                                    <TextBlock Text="{Binding WarningCount}" HorizontalAlignment="Center"
                                                                               FontSize="16" FontWeight="Bold" Foreground="Orange"/>
                                                                    <TextBlock Text="è­¦å‘Š" HorizontalAlignment="Center" FontSize="11"/>
                                                                </StackPanel>
                                                                <StackPanel Grid.Column="2" HorizontalAlignment="Center"
                                                                            ToolTip.Tip="ç‹€æ…‹ç‚º CRITICAL çš„æª¢æŸ¥é …ç›®æ•¸é‡ï¼ˆè¶…éŽå±éšªé–¾å€¼ï¼‰">
                                                                    <TextBlock Text="{Binding CriticalCount}" HorizontalAlignment="Center"
                                                                               FontSize="16" FontWeight="Bold" Foreground="Red"/>
                                                                    <TextBlock Text="å±éšª" HorizontalAlignment="Center" FontSize="11"/>
                                                                </StackPanel>
                                                            </Grid>
                                                            <TextBlock Text="é»žæ“ŠæŸ¥çœ‹å‘Šè­¦ â†’" FontSize="10" Foreground="Gray"
                                                                       HorizontalAlignment="Right" Opacity="0.7"/>
                                                        </StackPanel>
                                                    </Border>
                                                </ControlTemplate>
                                            </Button.Template>
                                        </Button>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>

                <!-- å³æ™‚æŒ‡æ¨™åˆ†é  -->
                <TabItem Header="å³æ™‚æŒ‡æ¨™">
                    <Grid RowDefinitions="Auto,*">
                        <!-- èªªæ˜Ž -->
                        <Border Grid.Row="0" Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                                CornerRadius="5" Padding="10" Margin="10,10,10,0">
                            <StackPanel Spacing="3">
                                <TextBlock Text="å³æ™‚æŒ‡æ¨™ç‹€æ…‹" FontWeight="Bold" FontSize="12"/>
                                <TextBlock Text="â€¢ é¡¯ç¤ºã€Œæœ€æ–°ä¸€æ¬¡å¥åº·æª¢æŸ¥ã€å„é …æŒ‡æ¨™çš„è©³ç´°æ•¸å€¼èˆ‡ç‹€æ…‹"
                                           FontSize="11" Foreground="Gray"/>
                                <TextBlock Text="â€¢ ã€Œæª¢æŸ¥æ™‚é–“ã€ç‚ºè©²æŒ‡æ¨™æœ€å¾ŒåŸ·è¡Œå¥åº·æª¢æŸ¥çš„æ™‚é–“é»ž"
                                           FontSize="11" Foreground="Gray"/>
                                <TextBlock Text="â€¢ ç›®å‰å€¼è¶…éŽé–¾å€¼æ™‚ï¼Œç‹€æ…‹æœƒé¡¯ç¤ºç‚º WARNING æˆ– CRITICAL"
                                           FontSize="11" Foreground="Gray"/>
                            </StackPanel>
                        </Border>
                        <!-- æŒ‡æ¨™æ¸…å–® -->
                        <DataGrid Grid.Row="1" ItemsSource="{Binding CurrentMetrics}"
                                  AutoGenerateColumns="False"
                                  IsReadOnly="True"
                                  CanUserResizeColumns="True"
                                  CanUserSortColumns="True"
                                  Margin="10">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="é¡žåž‹" Binding="{Binding CheckType}" Width="100"/>
                                <DataGridTextColumn Header="æŒ‡æ¨™åç¨±" Binding="{Binding MetricName}" Width="200"/>
                                <DataGridTextColumn Header="ç›®å‰å€¼" Binding="{Binding MetricValue, StringFormat={}{0:N2}}" Width="100"/>
                                <DataGridTextColumn Header="é–¾å€¼" Binding="{Binding ThresholdValue, StringFormat={}{0:N2}}" Width="100"/>
                                <DataGridTemplateColumn Header="ç‹€æ…‹" Width="80">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate x:DataType="domain:HealthMetric">
                                            <TextBlock Text="{Binding Status}"
                                                       Foreground="{Binding Status, Converter={StaticResource HealthStatusColorConverter}}"
                                                       FontWeight="Bold"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn Header="æª¢æŸ¥æ™‚é–“" Binding="{Binding CheckTime, StringFormat={}{0:yyyy-MM-dd HH:mm:ss}}" Width="150"/>
                                <DataGridTextColumn Header="å‘Šè­¦è¨Šæ¯" Binding="{Binding AlertMessage}" Width="*"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </TabItem>

                <!-- å‘Šè­¦åˆ†é  -->
                <TabItem Header="å‘Šè­¦">
                    <Grid RowDefinitions="Auto,Auto,*">
                        <!-- èªªæ˜Ž -->
                        <Border Grid.Row="0" Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                                CornerRadius="5" Padding="10" Margin="10,10,10,0">
                            <StackPanel Spacing="3">
                                <TextBlock Text="æ­·å²å¥åº·æª¢æŸ¥è¨˜éŒ„" FontWeight="Bold" FontSize="12"/>
                                <TextBlock Text="â€¢ å¯ä¾é¡žåž‹ã€ç‹€æ…‹ã€å¤©æ•¸ç¯©é¸ï¼Œé»žæ“Šåˆ—å¯å±•é–‹è©³ç´°è³‡è¨Š"
                                           FontSize="11" Foreground="Gray"/>
                                <TextBlock Text="â€¢ é è¨­é¡¯ç¤º WARNING å’Œ CRITICALï¼Œå¯å‹¾é¸ OK æŸ¥çœ‹æ­£å¸¸è¨˜éŒ„"
                                           FontSize="11" Foreground="Gray"/>
                            </StackPanel>
                        </Border>
                        <!-- ç¯©é¸ -->
                        <WrapPanel Grid.Row="1" Orientation="Horizontal" Margin="10">
                            <TextBlock Text="é¡žåž‹ï¼š" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <ComboBox MinWidth="120"
                                      ItemsSource="{Binding AlertCheckTypeOptions}"
                                      SelectedItem="{Binding AlertCheckTypeFilter}"
                                      PlaceholderText="å…¨éƒ¨"
                                      Margin="0,0,10,0"/>
                            <TextBlock Text="ç‹€æ…‹ï¼š" VerticalAlignment="Center" Margin="10,0,5,0"/>
                            <CheckBox IsChecked="{Binding FilterStatusOk}" VerticalAlignment="Center" Margin="0,0,10,0">
                                <TextBlock Text="OK" Foreground="Green" FontWeight="Bold"/>
                            </CheckBox>
                            <CheckBox IsChecked="{Binding FilterStatusWarning}" VerticalAlignment="Center" Margin="0,0,10,0">
                                <TextBlock Text="WARNING" Foreground="Orange" FontWeight="Bold"/>
                            </CheckBox>
                            <CheckBox IsChecked="{Binding FilterStatusCritical}" VerticalAlignment="Center" Margin="0,0,10,0">
                                <TextBlock Text="CRITICAL" Foreground="Red" FontWeight="Bold"/>
                            </CheckBox>
                            <TextBlock Text="é¡¯ç¤ºæœ€è¿‘ï¼š" VerticalAlignment="Center" Margin="10,0,5,0"/>
                            <ComboBox MinWidth="80"
                                      ItemsSource="{Binding AlertDaysOptions}"
                                      SelectedItem="{Binding AlertDays}"
                                      Margin="0,0,5,0"/>
                            <TextBlock Text="å¤©" VerticalAlignment="Center" Margin="0,0,10,0"/>
                            <Button Content="æ¸…é™¤ç¯©é¸" Margin="10,0,0,0"
                                    Command="{Binding NavigateToAlertsCommand}"
                                    CommandParameter="{x:Null}"
                                    IsVisible="{Binding AlertCheckTypeFilter, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                        </WrapPanel>

                        <!-- å‘Šè­¦æ¸…å–®æˆ–ç„¡è³‡æ–™æç¤º -->
                        <Panel Grid.Row="2">
                            <DataGrid ItemsSource="{Binding RecentAlerts}"
                                      AutoGenerateColumns="False"
                                      IsReadOnly="True"
                                      CanUserResizeColumns="True"
                                      CanUserSortColumns="True"
                                      AreRowDetailsFrozen="True"
                                      RowDetailsVisibilityMode="VisibleWhenSelected"
                                      Margin="10,0,10,10"
                                      IsVisible="{Binding HasAlerts}">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="æ™‚é–“" Binding="{Binding CheckTime, StringFormat={}{0:yyyy-MM-dd HH:mm}}" Width="130"/>
                                <DataGridTextColumn Header="é¡žåž‹" Binding="{Binding CheckType}" Width="100"/>
                                <DataGridTextColumn Header="æŒ‡æ¨™" Binding="{Binding MetricName}" Width="150"/>
                                <DataGridTextColumn Header="å€¼" Binding="{Binding MetricValue, StringFormat={}{0:N2}}" Width="80"/>
                                <DataGridTextColumn Header="é–¾å€¼" Binding="{Binding ThresholdValue, StringFormat={}{0:N2}}" Width="80"/>
                                <DataGridTemplateColumn Header="ç‹€æ…‹" Width="80">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate x:DataType="domain:HealthLogEntry">
                                            <TextBlock Text="{Binding Status}"
                                                       Foreground="{Binding Status, Converter={StaticResource HealthStatusColorConverter}}"
                                                       FontWeight="Bold"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn Header="å‘Šè­¦è¨Šæ¯" Binding="{Binding AlertMessage}" Width="*"/>
                            </DataGrid.Columns>
                            <DataGrid.RowDetailsTemplate>
                                <DataTemplate x:DataType="domain:HealthLogEntry">
                                    <Border Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                                            Padding="20,10" Margin="0,2">
                                        <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto,Auto,Auto"
                                              HorizontalAlignment="Left">
                                            <TextBlock Grid.Row="0" Grid.Column="0" Text="ä¼ºæœå™¨ï¼š" FontWeight="SemiBold" Margin="0,2"/>
                                            <SelectableTextBlock Grid.Row="0" Grid.Column="1" Text="{Binding ServerName}" Margin="10,2"/>

                                            <TextBlock Grid.Row="1" Grid.Column="0" Text="è³‡æ–™åº«ï¼š" FontWeight="SemiBold" Margin="0,2"/>
                                            <SelectableTextBlock Grid.Row="1" Grid.Column="1" Text="{Binding DatabaseName}" Margin="10,2"/>

                                            <TextBlock Grid.Row="2" Grid.Column="0" Text="å‘Šè­¦è¨Šæ¯ï¼š" FontWeight="SemiBold" Margin="0,2"/>
                                            <SelectableTextBlock Grid.Row="2" Grid.Column="1" Text="{Binding AlertMessage}" Margin="10,2" TextWrapping="Wrap"/>

                                            <TextBlock Grid.Row="3" Grid.Column="0" Text="é¡å¤–è³‡è¨Šï¼š" FontWeight="SemiBold" Margin="0,2"/>
                                            <SelectableTextBlock Grid.Row="3" Grid.Column="1" Text="{Binding AdditionalInfo}" Margin="10,2" TextWrapping="Wrap"/>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </DataGrid.RowDetailsTemplate>
                            </DataGrid>
                            <TextBlock Text="{Binding AlertsEmptyMessage}"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       FontSize="14"
                                       Foreground="Gray"
                                       TextAlignment="Center"
                                       IsVisible="{Binding !HasAlerts}"/>
                        </Panel>
                    </Grid>
                </TabItem>

                <!-- è¶¨å‹¢åˆ†é  -->
                <TabItem Header="è¶¨å‹¢">
                    <Grid RowDefinitions="Auto,*">
                        <!-- é¸æ“‡å™¨ -->
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="10" Margin="10">
                            <TextBlock Text="æª¢æŸ¥é¡žåž‹ï¼š" VerticalAlignment="Center"/>
                            <ComboBox MinWidth="120"
                                      ItemsSource="{Binding TrendCheckTypes}"
                                      SelectedItem="{Binding SelectedTrendCheckType}"/>
                            <TextBlock Text="æŒ‡æ¨™ï¼š" VerticalAlignment="Center" Margin="20,0,0,0"/>
                            <ComboBox MinWidth="180"
                                      ItemsSource="{Binding TrendMetricNames}"
                                      SelectedItem="{Binding SelectedTrendMetricName}"/>
                        </StackPanel>

                        <!-- åœ–è¡¨æˆ–ç„¡è³‡æ–™æç¤º -->
                        <Panel Grid.Row="1">
                            <lvc:CartesianChart Series="{Binding TrendSeries}"
                                                XAxes="{Binding TrendXAxes}"
                                                YAxes="{Binding TrendYAxes}"
                                                Margin="10"
                                                IsVisible="{Binding HasTrendData}"/>
                            <SelectableTextBlock Text="{Binding TrendNoDataMessage}"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="16"
                                               Foreground="Gray"
                                               IsVisible="{Binding !HasTrendData}"/>
                        </Panel>
                    </Grid>
                </TabItem>

                <!-- ç›£æŽ§è¨­å®šåˆ†é  -->
                <TabItem Header="ç›£æŽ§è¨­å®š">
                    <DataGrid ItemsSource="{Binding Categories}"
                              AutoGenerateColumns="False"
                              CanUserResizeColumns="True"
                              Margin="10">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="é¡žåˆ¥åç¨±" Binding="{Binding CategoryName}" Width="120" IsReadOnly="True"/>
                            <DataGridTextColumn Header="æè¿°" Binding="{Binding Description}" Width="200" IsReadOnly="True"/>
                            <DataGridCheckBoxColumn Header="å•Ÿç”¨" Binding="{Binding IsEnabled}" Width="60"/>
                            <DataGridTextColumn Header="æª¢æŸ¥é–“éš”ï¼ˆåˆ†é˜ï¼‰" Binding="{Binding CheckIntervalMinutes}" Width="120"/>
                            <DataGridTextColumn Header="ä¸Šæ¬¡æª¢æŸ¥" Binding="{Binding LastCheckTime, StringFormat={}{0:yyyy-MM-dd HH:mm}}" Width="140" IsReadOnly="True"/>
                            <DataGridTemplateColumn Header="æ“ä½œ" Width="80">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate x:DataType="domain:MonitoringCategory">
                                        <Button Content="å„²å­˜"
                                                Command="{Binding $parent[DataGrid].((vm:HealthMonitoringDocumentViewModel)DataContext).UpdateCategoryCommand}"
                                                CommandParameter="{Binding}"
                                                Padding="8,4"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </TabItem>
            </TabControl>
        </Grid>

        <!-- ç‹€æ…‹åˆ— -->
        <Border Grid.Row="2" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}" Padding="10,5">
            <TextBlock Text="{Binding StatusMessage}"/>
        </Border>
    </Grid>
</UserControl>
