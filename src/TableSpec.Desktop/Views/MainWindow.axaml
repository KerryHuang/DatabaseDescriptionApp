<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:TableSpec.Desktop.ViewModels"
        xmlns:views="using:TableSpec.Desktop.Views"
        xmlns:domain="using:TableSpec.Domain.Entities"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="700"
        x:Class="TableSpec.Desktop.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/TableSpec.png"
        Title="TableSpec - è³‡æ–™åº«è¦æ ¼æŸ¥è©¢å·¥å…·"
        Width="1200" Height="700"
        MinWidth="800" MinHeight="500">

    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <DockPanel>
        <!-- åŠŸèƒ½è¡¨åˆ— + ä¸»é¡Œåˆ‡æ› -->
        <Grid DockPanel.Dock="Top" ColumnDefinitions="*,Auto">
            <Menu Grid.Column="0">
                <MenuItem Header="æª”æ¡ˆ(_F)">
                    <MenuItem Header="é€£ç·šè¨­å®š(_C)" Command="{Binding OpenConnectionSettingsCommand}" InputGesture="Ctrl+L"
                              ToolTip.Tip="ç®¡ç†è³‡æ–™åº«é€£ç·šè¨­å®šæª”">
                        <MenuItem.Icon>
                            <TextBlock Text="ðŸ”Œ" FontSize="14"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="åŒ¯å‡º Excel(_E)" Command="{Binding ExportToExcelCommand}" IsEnabled="{Binding IsConnected}"
                              ToolTip.Tip="å°‡ç›®å‰è³‡æ–™åº«çš„æ‰€æœ‰ç‰©ä»¶è¦æ ¼åŒ¯å‡ºç‚º Excel æª”æ¡ˆ">
                        <MenuItem.Icon>
                            <TextBlock Text="ðŸ“¤" FontSize="14"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <Separator/>
                    <MenuItem Header="çµæŸ(_X)" Command="{Binding ExitCommand}" InputGesture="Alt+F4"
                              ToolTip.Tip="é—œé–‰æ‡‰ç”¨ç¨‹å¼">
                        <MenuItem.Icon>
                            <TextBlock Text="ðŸšª" FontSize="14"/>
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>
                <MenuItem Header="æª¢è¦–(_V)">
                    <MenuItem Header="æ·±è‰²æ¨¡å¼(_D)" Command="{Binding ToggleThemeCommand}"
                              ToolTip.Tip="åˆ‡æ›æ·±è‰²/æ·ºè‰²ä¸»é¡Œ">
                        <MenuItem.Icon>
                            <CheckBox IsChecked="{Binding IsDarkMode}" BorderThickness="0" IsHitTestVisible="False"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <Separator/>
                    <MenuItem Header="é—œé–‰ç›®å‰åˆ†é (_C)" Command="{Binding CloseCurrentDocumentCommand}" InputGesture="Ctrl+W"
                              ToolTip.Tip="é—œé–‰ç›®å‰é¸å–çš„åˆ†é ">
                        <MenuItem.Icon>
                            <TextBlock Text="âœ•" FontSize="14"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="é—œé–‰æ‰€æœ‰åˆ†é (_A)" Command="{Binding CloseAllDocumentsCommand}"
                              ToolTip.Tip="é—œé–‰æ‰€æœ‰å·²é–‹å•Ÿçš„åˆ†é ">
                        <MenuItem.Icon>
                            <TextBlock Text="âœ•âœ•" FontSize="12"/>
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>
                <MenuItem Header="å·¥å…·(_T)">
                    <MenuItem Header="SQL æŸ¥è©¢(_S)" Command="{Binding OpenSqlQueryCommand}" InputGesture="Ctrl+Q" IsEnabled="{Binding IsConnected}"
                              ToolTip.Tip="é–‹å•Ÿ SQL æŸ¥è©¢ç·¨è¼¯å™¨ï¼ŒåŸ·è¡Œè‡ªè¨‚æŸ¥è©¢">
                        <MenuItem.Icon>
                            <TextBlock Text="ðŸ“" FontSize="14"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="æ¬„ä½æœå°‹(_F)" Command="{Binding OpenColumnSearchCommand}" InputGesture="Ctrl+F" IsEnabled="{Binding IsConnected}"
                              ToolTip.Tip="æœå°‹æ¬„ä½åç¨±ï¼Œåˆ†æžåž‹æ…‹ä¸€è‡´æ€§">
                        <MenuItem.Icon>
                            <TextBlock Text="ðŸ”" FontSize="14"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <Separator/>
                    <MenuItem Header="å‚™ä»½èˆ‡é‚„åŽŸ(_B)" Command="{Binding OpenBackupRestoreCommand}" InputGesture="Ctrl+B" IsEnabled="{Binding IsConnected}"
                              ToolTip.Tip="å‚™ä»½æˆ–é‚„åŽŸè³‡æ–™åº«">
                        <MenuItem.Icon>
                            <TextBlock Text="ðŸ’¾" FontSize="14"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="çµæ§‹æ¯”å°(_M)" Command="{Binding OpenSchemaCompareCommand}" InputGesture="Ctrl+M"
                              ToolTip.Tip="æ¯”å°ä¸åŒç’°å¢ƒçš„è³‡æ–™åº«çµæ§‹å·®ç•°">
                        <MenuItem.Icon>
                            <TextBlock Text="ðŸ”„" FontSize="14"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="å¥åº·ç›£æŽ§(_H)" Command="{Binding OpenHealthMonitoringCommand}" InputGesture="Ctrl+H" IsEnabled="{Binding IsConnected}"
                              ToolTip.Tip="ç›£æŽ§è³‡æ–™åº«å¥åº·ç‹€æ…‹èˆ‡æ•ˆèƒ½æŒ‡æ¨™">
                        <MenuItem.Icon>
                            <TextBlock Text="ðŸ©º" FontSize="14"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="æ•ˆèƒ½è¨ºæ–·(_P)" Command="{Binding OpenPerformanceDiagnosticsCommand}" InputGesture="Ctrl+P" IsEnabled="{Binding IsConnected}"
                              ToolTip.Tip="åˆ†æž SQL Server æ•ˆèƒ½ï¼ŒåŒ…å«ç­‰å€™äº‹ä»¶ã€è€—æ™‚æŸ¥è©¢ã€ç´¢å¼•ç‹€æ…‹">
                        <MenuItem.Icon>
                            <TextBlock Text="âš¡" FontSize="14"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="æ¬„ä½çµ±è¨ˆ(_U)" Command="{Binding OpenColumnUsageCommand}" InputGesture="Ctrl+U" IsEnabled="{Binding IsConnected}"
                              ToolTip.Tip="çµ±è¨ˆæ¬„ä½ä½¿ç”¨æƒ…æ³ï¼Œåˆ†æžåž‹æ…‹ä¸€è‡´æ€§">
                        <MenuItem.Icon>
                            <TextBlock Text="ðŸ“Š" FontSize="14"/>
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>
                <MenuItem Header="èªªæ˜Ž(_H)">
                    <MenuItem Header="é—œæ–¼ TableSpec(_A)" Command="{Binding ShowAboutCommand}"
                              ToolTip.Tip="é¡¯ç¤ºæ‡‰ç”¨ç¨‹å¼ç‰ˆæœ¬èˆ‡ç›¸é—œè³‡è¨Š">
                        <MenuItem.Icon>
                            <TextBlock Text="â„¹ï¸" FontSize="14"/>
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>
            </Menu>

            <!-- å³å´ï¼šä¸»é¡Œåˆ‡æ› -->
            <Button Grid.Column="1"
                    Content="{Binding ThemeIcon}"
                    Command="{Binding ToggleThemeCommand}"
                    ToolTip.Tip="åˆ‡æ›æ·±è‰²/æ·ºè‰²æ¨¡å¼"
                    FontSize="16"
                    Padding="10,4"
                    Margin="5,0"
                    Background="Transparent"
                    BorderThickness="0"/>
        </Grid>

        <!-- åº•éƒ¨ç‹€æ…‹åˆ— -->
        <Border DockPanel.Dock="Bottom" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}" Padding="10,5">
            <Grid ColumnDefinitions="*,Auto">
                <TextBlock Grid.Column="0" Text="{Binding StatusMessage}" VerticalAlignment="Center"/>
                <ProgressBar Grid.Column="1" IsIndeterminate="True" Width="100"
                             IsVisible="{Binding IsExporting}" VerticalAlignment="Center"/>
            </Grid>
        </Border>

        <!-- ä¸»å…§å®¹å€åŸŸ -->
        <Grid ColumnDefinitions="280,5,*">
            <!-- å·¦å´ï¼šç‰©ä»¶æ¨¹ -->
            <Border Grid.Column="0" Background="{DynamicResource SystemControlBackgroundAltMediumLowBrush}">
                <DockPanel>
                    <!-- é€£ç·šé¸æ“‡å€ -->
                    <Border DockPanel.Dock="Top" Padding="10" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}">
                        <StackPanel Spacing="8">
                            <ComboBox ItemsSource="{Binding ConnectionProfiles}"
                                      SelectedItem="{Binding SelectedProfile}"
                                      PlaceholderText="è«‹é¸æ“‡é€£ç·š..."
                                      HorizontalAlignment="Stretch">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate x:DataType="domain:ConnectionProfile">
                                        <TextBlock Text="{Binding Name}"/>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                            <Button Content="è¨­å®šé€£ç·š"
                                    Command="{Binding OpenConnectionSettingsCommand}"
                                    HorizontalAlignment="Stretch"
                                    HorizontalContentAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- æœå°‹æ¡† -->
                    <Border DockPanel.Dock="Top" Padding="10,10,10,5">
                        <TextBox Watermark="æœå°‹ç‰©ä»¶..."
                                 Text="{Binding ObjectTree.SearchText, Mode=TwoWay}"/>
                    </Border>

                    <!-- ç‰©ä»¶æ¸…å–® -->
                    <TreeView x:Name="ObjectTreeView"
                              ItemsSource="{Binding ObjectTree.Groups}" Margin="5"
                              SelectionMode="Single"
                              SelectionChanged="OnTreeViewSelectionChanged">
                        <TreeView.DataTemplates>
                            <!-- ç¾¤çµ„æ¨¡æ¿ -->
                            <TreeDataTemplate DataType="{x:Type vm:ObjectGroupViewModel}"
                                              ItemsSource="{Binding Items}">
                                <StackPanel Orientation="Horizontal" Spacing="5">
                                    <TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
                                    <TextBlock Text="{Binding VisibleCount, StringFormat='({0})'}"
                                               Foreground="Gray"/>
                                </StackPanel>
                            </TreeDataTemplate>
                            <!-- é …ç›®æ¨¡æ¿ -->
                            <DataTemplate DataType="{x:Type vm:ObjectItemViewModel}">
                                <TextBlock Text="{Binding DisplayName}"/>
                            </DataTemplate>
                        </TreeView.DataTemplates>
                        <TreeView.Styles>
                            <Style Selector="TreeViewItem">
                                <Setter Property="IsExpanded" Value="True"/>
                            </Style>
                            <!-- éš±è—ä¸å¯è¦‹çš„é …ç›® -->
                            <Style Selector="TreeViewItem" x:DataType="vm:ObjectItemViewModel">
                                <Setter Property="IsVisible" Value="{Binding IsVisible}"/>
                            </Style>
                        </TreeView.Styles>
                    </TreeView>
                </DockPanel>
            </Border>

            <!-- åˆ†éš”ç·š -->
            <GridSplitter Grid.Column="1" Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                          ResizeDirection="Columns"/>

            <!-- å³å´ï¼šMDI TabControl å€åŸŸ -->
            <Border Grid.Column="2" Padding="5">
                <Grid>
                    <!-- ç©ºç™½æç¤º -->
                    <TextBlock Text="è«‹å¾žå·¦å´é¸æ“‡ç‰©ä»¶ï¼Œæˆ–ä½¿ç”¨é¸å–®é–‹å•Ÿ SQL æŸ¥è©¢"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               Foreground="Gray"
                               FontSize="14"
                               IsVisible="{Binding !Documents.Count}"/>

                    <!-- MDI TabControl -->
                    <TabControl ItemsSource="{Binding Documents}"
                                SelectedItem="{Binding SelectedDocument}"
                                IsVisible="{Binding Documents.Count}">
                        <TabControl.Styles>
                            <Style Selector="TabItem">
                                <Setter Property="Padding" Value="10,6"/>
                            </Style>
                            <!-- é—œé–‰æŒ‰éˆ•æ¨£å¼ -->
                            <Style Selector="Button.tab-close">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="BorderThickness" Value="0"/>
                                <Setter Property="Padding" Value="4,2"/>
                                <Setter Property="Margin" Value="4,0,0,0"/>
                                <Setter Property="CornerRadius" Value="3"/>
                                <Setter Property="Opacity" Value="0.6"/>
                            </Style>
                            <Style Selector="Button.tab-close:pointerover">
                                <Setter Property="Background" Value="#40FF0000"/>
                                <Setter Property="Opacity" Value="1"/>
                            </Style>
                            <Style Selector="Button.tab-close:pressed">
                                <Setter Property="Background" Value="#80FF0000"/>
                            </Style>
                        </TabControl.Styles>
                        <TabControl.ItemTemplate>
                            <DataTemplate DataType="{x:Type vm:DocumentViewModel}">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <TextBlock Text="{Binding Icon}" FontSize="14" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding Title}" VerticalAlignment="Center"/>
                                    <Button Classes="tab-close"
                                            Command="{Binding $parent[TabControl].((vm:MainWindowViewModel)DataContext).CloseDocumentCommand}"
                                            CommandParameter="{Binding}"
                                            IsVisible="{Binding CanClose}"
                                            ToolTip.Tip="é—œé–‰åˆ†é  (Ctrl+W)">
                                        <TextBlock Text="âœ•" FontSize="12" VerticalAlignment="Center"/>
                                    </Button>
                                </StackPanel>
                            </DataTemplate>
                        </TabControl.ItemTemplate>
                        <TabControl.ContentTemplate>
                            <DataTemplate>
                                <ContentControl Content="{Binding}">
                                    <ContentControl.DataTemplates>
                                        <DataTemplate DataType="{x:Type vm:TableDetailDocumentViewModel}">
                                            <views:TableDetailDocumentView/>
                                        </DataTemplate>
                                        <DataTemplate DataType="{x:Type vm:SqlQueryDocumentViewModel}">
                                            <views:SqlQueryDocumentView/>
                                        </DataTemplate>
                                        <DataTemplate DataType="{x:Type vm:ColumnSearchDocumentViewModel}">
                                            <views:ColumnSearchDocumentView/>
                                        </DataTemplate>
                                        <DataTemplate DataType="{x:Type vm:BackupRestoreDocumentViewModel}">
                                            <views:BackupRestoreDocumentView/>
                                        </DataTemplate>
                                        <DataTemplate DataType="{x:Type vm:SchemaCompareDocumentViewModel}">
                                            <views:SchemaCompareDocumentView/>
                                        </DataTemplate>
                                        <DataTemplate DataType="{x:Type vm:HealthMonitoringDocumentViewModel}">
                                            <views:HealthMonitoringDocumentView/>
                                        </DataTemplate>
                                        <DataTemplate DataType="{x:Type vm:PerformanceDiagnosticsDocumentViewModel}">
                                            <views:PerformanceDiagnosticsDocumentView/>
                                        </DataTemplate>
                                        <DataTemplate DataType="{x:Type vm:AboutDocumentViewModel}">
                                            <views:AboutDocumentView/>
                                        </DataTemplate>
                                        <DataTemplate DataType="{x:Type vm:ColumnUsageDocumentViewModel}">
                                            <views:ColumnUsageDocumentView/>
                                        </DataTemplate>
                                    </ContentControl.DataTemplates>
                                </ContentControl>
                            </DataTemplate>
                        </TabControl.ContentTemplate>
                    </TabControl>
                </Grid>
            </Border>
        </Grid>
    </DockPanel>
</Window>
