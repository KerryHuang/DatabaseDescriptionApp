# TableSpec 使用手冊

## 目錄

1. [簡介](#簡介)
2. [安裝與啟動](#安裝與啟動)
3. [設定資料庫連線](#設定資料庫連線)
4. [瀏覽資料庫物件](#瀏覽資料庫物件)
5. [查看物件詳細資訊](#查看物件詳細資訊)
6. [編輯欄位說明](#編輯欄位說明)
7. [SQL 查詢工具](#sql-查詢工具)
8. [欄位搜尋與一致性分析](#欄位搜尋與一致性分析)
9. [匯出 Excel 報表](#匯出-excel-報表)
10. [備份與還原](#備份與還原)
11. [健康監控](#健康監控)
12. [快捷鍵一覽](#快捷鍵一覽)
13. [常見問題](#常見問題)

---

## 簡介

TableSpec 是一個資料庫規格查詢工具，可以幫助您：

- 瀏覽 SQL Server 資料庫的結構
- 查看資料表、檢視表、預存程序、函數的詳細資訊
- 編輯欄位說明
- 檢查欄位命名與型態的一致性
- 匯出資料庫規格為 Excel 檔案
- 備份與還原資料庫
- 監控 SQL Server 伺服器的健康狀態

本軟體支援 Windows、macOS、Linux 三種作業系統。

---

## 安裝與啟動

### 下載

從 [GitHub Releases](https://github.com/KerryHuang/DatabaseDescriptionApp/releases) 下載適合您作業系統的版本：

| 作業系統 | 下載連結 | 說明 |
|---------|----------|------|
| Windows x64 | [TableSpec-win-Setup.exe](https://github.com/KerryHuang/DatabaseDescriptionApp/releases/latest/download/TableSpec-win-Setup.exe) | 安裝程式（推薦） |
| Windows x64 | [TableSpec-win-Portable.zip](https://github.com/KerryHuang/DatabaseDescriptionApp/releases/latest/download/TableSpec-win-Portable.zip) | 可攜式版本 |
| macOS (Apple Silicon) | [TableSpec-osx-arm64.zip](https://github.com/KerryHuang/DatabaseDescriptionApp/releases/latest) | 從 Releases 頁面下載 |
| Linux x64 | [TableSpec.AppImage](https://github.com/KerryHuang/DatabaseDescriptionApp/releases/latest/download/TableSpec.AppImage) | AppImage 格式 |

### 系統需求

- 作業系統：Windows 10/11、macOS 11+、Linux（glibc 2.17+）
- SQL Server 2008 或更新版本

### 安裝步驟

1. 下載對應您作業系統的壓縮檔
2. 解壓縮到任意目錄
3. 無需安裝 .NET Runtime，可直接執行

### 啟動程式

1. 找到解壓縮後的 TableSpec 執行檔
2. 雙擊執行（macOS/Linux 可能需要先賦予執行權限：`chmod +x TableSpec`）

首次啟動時，程式會顯示空白畫面，您需要先設定資料庫連線。

---

## 設定資料庫連線

### 步驟一：開啟連線設定

點擊工具列上的 **「設定連線」** 按鈕，開啟連線設定視窗。

```
┌─────────────────────────────────────┐
│  [設定連線]  [連線▼]  [匯出Excel]   │
└─────────────────────────────────────┘
```

### 步驟二：新增連線

1. 點擊 **「新增」** 按鈕
2. 輸入連線名稱（例如：「測試伺服器」）
3. 輸入伺服器位址（例如：`localhost` 或 `192.168.1.100`）
4. 輸入資料庫名稱
5. 選擇驗證方式：
   - **Windows 驗證**：使用您目前的 Windows 帳號登入
   - **SQL Server 驗證**：輸入 SQL Server 的帳號密碼

### 步驟三：測試連線

1. 點擊 **「測試連線」** 按鈕
2. 如果顯示「連線成功」，表示設定正確
3. 如果連線失敗，請檢查：
   - 伺服器位址是否正確
   - 資料庫名稱是否正確
   - 帳號密碼是否正確
   - SQL Server 是否允許遠端連線

### 步驟四：儲存並連線

1. 點擊 **「儲存」** 按鈕保存設定
2. 點擊 **「連線」** 按鈕連接資料庫

連線成功後，左側會顯示資料庫物件清單。

---

## 瀏覽資料庫物件

### 物件樹狀結構

連線成功後，左側會顯示四個類別：

```
📁 Tables（資料表）
   └── 📋 dbo.Customers
   └── 📋 dbo.Orders
   └── ...

📁 Views（檢視表）
   └── 📋 dbo.vw_OrderSummary
   └── ...

📁 Stored Procedures（預存程序）
   └── 📋 dbo.sp_GetCustomer
   └── ...

📁 Functions（函數）
   └── 📋 dbo.fn_CalculateTotal
   └── ...
```

### 搜尋物件

在搜尋框中輸入關鍵字，可以快速找到物件：

```
┌────────────────────────┐
│ 🔍 [搜尋物件...]       │
└────────────────────────┘
```

- 輸入物件名稱的任意部分即可搜尋
- 搜尋會同時比對物件名稱和說明
- 清空搜尋框可顯示所有物件

### 切換連線

如果您有多個資料庫連線，可以從下拉選單切換：

```
[連線▼] → 選擇其他連線
```

---

## 查看物件詳細資訊

### 開啟物件

在左側物件清單中，雙擊任一物件，右側會開啟詳細資訊分頁。

### 資料表/檢視表 詳細資訊

開啟資料表或檢視表後，會顯示以下頁籤：

#### 欄位頁籤
顯示所有欄位的定義：

| 欄位名稱 | 型別 | 長度 | 主鍵 | 可空 | 預設值 | 說明 |
|---------|------|------|------|------|--------|------|
| Id | int | 4 | ✓ | | | 主鍵 |
| Name | nvarchar | 100 | | ✓ | | 名稱 |

#### 索引頁籤（僅資料表）
顯示資料表的索引：

| 索引名稱 | 類型 | 唯一 | 欄位 |
|---------|------|------|------|
| PK_Customers | CLUSTERED | ✓ | Id |
| IX_Name | NONCLUSTERED | | Name |

#### 關聯頁籤（僅資料表）
顯示外鍵關聯：

| 約束名稱 | 來源欄位 | 目標資料表 | 目標欄位 |
|---------|---------|-----------|---------|
| FK_Orders_Customer | CustomerId | Customers | Id |

### 預存程序/函數 詳細資訊

開啟預存程序或函數後，會顯示：

#### 參數頁籤
顯示輸入/輸出參數：

| 參數名稱 | 型別 | 長度 | 方向 | 說明 |
|---------|------|------|------|------|
| @CustomerId | int | 4 | IN | 客戶編號 |
| @Result | int | 4 | OUT | 回傳值 |

#### 定義頁籤
顯示完整的 SQL 程式碼。

### 關閉分頁

每個分頁標籤右側有一個 **✕** 按鈕，點擊可關閉該分頁。

也可以使用快捷鍵 **Ctrl+W** 關閉目前分頁。

---

## 編輯欄位說明

TableSpec 可以讓您直接編輯資料表或檢視表的欄位說明。

### 步驟

1. 開啟資料表或檢視表
2. 在「欄位」頁籤中，找到要編輯的欄位
3. 在「說明」欄位中直接輸入或修改文字
4. 點擊 **「儲存說明」** 按鈕

### 注意事項

- 需要有資料庫的寫入權限才能儲存
- 修改會即時寫入資料庫
- 建議定期備份資料庫

---

## SQL 查詢工具

TableSpec 內建 SQL 查詢工具，可以執行自訂查詢。

### 開啟查詢視窗

- 選單：**工具 → SQL 查詢**
- 快捷鍵：**Ctrl+Q**

### 執行查詢

1. 在查詢區域輸入 SQL 語句
2. 點擊 **「執行」** 按鈕或按 **F5**
3. 結果會顯示在下方表格中

```sql
-- 範例查詢
SELECT TOP 100 * FROM Customers WHERE Country = 'Taiwan'
```

### 匯出查詢結果

1. 執行查詢後，點擊 **「匯出 CSV」** 按鈕
2. 選擇儲存位置
3. 結果會匯出為 CSV 檔案

### 查詢歷史

最近執行的查詢會保留在視窗中，方便您再次使用。

---

## 欄位搜尋與一致性分析

這是 TableSpec 最強大的功能之一，可以幫助您：
- 搜尋資料庫中所有包含特定名稱的欄位
- 檢查同名欄位的型態是否一致
- 批次更新欄位長度
- 批次套用欄位說明

### 開啟欄位搜尋

- 選單：**工具 → 欄位搜尋**
- 快捷鍵：**Ctrl+F**

### 搜尋欄位

1. 輸入欄位名稱關鍵字（例如：`Id` 或 `Name`）
2. 點擊 **「搜尋」** 按鈕
3. 結果會列出所有符合的欄位

```
┌──────────────────────────────────────────────────────────┐
│ 欄位名稱   │ 物件類型 │ Schema │ 物件名稱    │ 資料型別   │
├──────────────────────────────────────────────────────────┤
│ CustomerId │ TABLE    │ dbo    │ Orders      │ int        │
│ CustomerId │ TABLE    │ dbo    │ Invoices    │ int        │
│ CustomerId │ VIEW     │ dbo    │ vw_Sales    │ int        │
└──────────────────────────────────────────────────────────┘
```

### 分析型態一致性

搜尋完成後，點擊 **「分析一致性」** 按鈕，系統會檢查同名欄位的型態是否一致。

結果以顏色標示：

| 顏色 | 等級 | 說明 |
|------|------|------|
| 🟢 綠色 | 一致 | 所有同名欄位的型態完全相同 |
| 🟡 黃色 | 警告 | 有少數欄位型態不同 |
| 🔴 紅色 | 嚴重 | 有多種不同型態，或不一致比例很高 |

### 查看詳細資訊

點擊左側的欄位群組，右側會顯示該欄位在各資料表中的詳細資訊：

```
欄位名稱：CustomerId
主要型態：int
資料表總數：15
不一致數量：2

┌──────────────────────────────────────────────────┐
│ 狀態    │ Schema │ 資料表      │ 型態          │
├──────────────────────────────────────────────────┤
│ ✗ 不一致│ dbo    │ OldOrders   │ varchar(10)   │
│ ✗ 不一致│ dbo    │ Archive     │ nvarchar(20)  │
│ ✓ 一致  │ dbo    │ Orders      │ int           │
│ ✓ 一致  │ dbo    │ Customers   │ int           │
└──────────────────────────────────────────────────┘
```

### 篩選結果

使用「篩選」下拉選單可以快速找到問題欄位：

- **全部**：顯示所有欄位
- **僅不一致**：只顯示型態不一致的欄位
- **僅一致**：只顯示型態一致的欄位

### 批次更新長度

如果發現多個欄位長度不一致（例如有些是 `varchar(50)`，有些是 `varchar(100)`），可以批次更新：

1. 選擇要更新的欄位群組
2. 在「批次更新」區域輸入新長度
3. 點擊 **「更新所有不一致項目」**
4. 系統會自動處理約束（PK、FK、Index），更新長度後再還原

> ⚠️ **注意**：此操作會修改資料庫結構，建議先備份。

### 套用說明至空白欄位

如果某個欄位在部分資料表有說明，但其他資料表沒有，可以批次套用：

1. 在搜尋結果中，選中一筆有說明的欄位
2. 點擊 **「套用說明至空白欄位」**
3. 確認對話框會顯示將要更新的欄位清單
4. 點擊 **「確認套用」**

```
┌─────────────────────────────────────────────────┐
│ 確認套用說明                                      │
│                                                  │
│ 將「客戶編號」套用至 5 個空白說明的欄位            │
│（資料表 3 個、檢視 2 個）：                       │
│                                                  │
│   • [TABLE] dbo.Orders.CustomerId               │
│   • [TABLE] dbo.Invoices.CustomerId             │
│   • [VIEW] dbo.vw_Sales.CustomerId              │
│   ... 等共 5 個                                  │
│                                                  │
│                        [取消]  [確認套用]         │
└─────────────────────────────────────────────────┘
```

---

## 匯出 Excel 報表

TableSpec 可以將整個資料庫的規格匯出為 Excel 檔案。

### 匯出步驟

1. 確認已連線到資料庫
2. 點擊工具列的 **「匯出 Excel」** 按鈕
3. 選擇儲存位置和檔名
4. 等待匯出完成

### 匯出內容

Excel 檔案包含多個工作表：

| 工作表 | 內容 |
|--------|------|
| Tables | 所有資料表及其欄位 |
| Views | 所有檢視表及其欄位 |
| StoredProcedures | 所有預存程序及其參數 |
| Functions | 所有函數及其參數 |
| Indexes | 所有索引 |
| Relations | 所有外鍵關聯 |

---

## 備份與還原

TableSpec 提供資料庫備份與還原功能，支援完整備份、差異備份和交易記錄備份。

### 開啟備份與還原

- 選單：**工具 → 備份與還原**
- 快捷鍵：**Ctrl+B**

### 備份資料庫

1. 在「備份」分頁選擇要備份的連線
2. 選擇備份類型：

| 類型 | 說明 |
|------|------|
| 完整備份 | 備份整個資料庫，建議定期執行 |
| 差異備份 | 備份自上次完整備份後的變更 |
| 交易記錄備份 | 備份交易記錄，可用於時間點還原 |

3. 設定備份儲存路徑（預設為 SQL Server 的備份目錄）
4. 可選填備份說明
5. 建議勾選「備份後驗證」確保備份完整性
6. 點擊 **「備份」** 按鈕

```
┌─────────────────────────────────────────┐
│ 備份設定                                  │
├─────────────────────────────────────────┤
│ 連線：     [測試伺服器     ▼]            │
│ 資料庫：   MyDatabase                    │
│ 備份類型： ○ 完整備份                     │
│           ○ 差異備份                     │
│           ○ 交易記錄備份                  │
│ 儲存路徑： [C:\Backup\MyDB.bak] [瀏覽]   │
│ 備份說明： [每日備份                ]     │
│ ☑ 備份後驗證                             │
│                                         │
│                        [備份]            │
└─────────────────────────────────────────┘
```

### 還原資料庫

1. 切換到「還原」分頁
2. 點擊 **「瀏覽」** 選擇備份檔案（.bak）
3. 系統會自動驗證並顯示備份檔案資訊
4. 選擇還原模式：
   - **覆蓋現有資料庫**：將備份還原到原資料庫（會覆蓋現有資料）
   - **建立新資料庫**：還原為新的資料庫
5. 選擇目標連線
6. 點擊 **「還原」** 按鈕

> ⚠️ **注意**：覆蓋現有資料庫會刪除目前的所有資料，請確認後再執行。

### 備份歷史記錄

「歷史」分頁顯示所有備份記錄：

| 欄位 | 說明 |
|------|------|
| 備份時間 | 執行備份的時間 |
| 連線名稱 | 備份的資料庫連線 |
| 資料庫 | 資料庫名稱 |
| 備份類型 | 完整/差異/交易記錄 |
| 檔案大小 | 備份檔案的大小 |
| 備份路徑 | 檔案儲存位置 |

可對歷史記錄執行以下操作：
- **還原**：直接從該備份還原
- **驗證**：檢查備份檔案是否有效
- **開啟資料夾**：在檔案總管中開啟備份所在目錄
- **移除記錄**：從歷史記錄中移除（不會刪除實際檔案）

---

## 健康監控

健康監控功能可以幫助 DBA 監控 SQL Server 伺服器的健康狀態，包含：

- CPU、記憶體、磁碟等系統資源使用率
- 資料庫連線數
- TempDB 使用量
- 自動告警與歷史趨勢分析

### 運作原理

健康監控會在目前連線的 SQL Server 上建立一個專用的 **DBA** 資料庫，用來：

- 儲存監控資料和歷史紀錄
- 執行定期的健康檢查
- 透過 SQL Agent 作業自動排程執行

### 開啟健康監控

從選單選擇 **工具 → 健康監控**，會開啟健康監控分頁。

首次使用時，會顯示「設定」面板，檢查安裝狀態：

```
┌─────────────────────────────────────┐
│ 安裝狀態                              │
├─────────────────────────────────────┤
│ DBA 資料庫：      ✗ 否               │
│ 監控記錄表：      ✗ 否               │
│ 監控類別表：      ✗ 否               │
│ 主監控程序：      ✗ 否               │
│ 監控視圖：        ✗ 否               │
│ SQL Agent 作業：  ✗ 否               │
│ 監控記錄數：      0 筆               │
└─────────────────────────────────────┘
```

### 安裝健康監控系統

1. 確認已連線到 SQL Server（需要 **sysadmin** 權限）
2. 在設定面板點擊 **「安裝健康監控系統」** 按鈕
3. 等待安裝完成，進度會顯示在下方

安裝會建立以下項目：

| 項目 | 說明 |
|------|------|
| DBA 資料庫 | 專用資料庫，儲存所有監控資料 |
| ServerHealthLog 資料表 | 儲存歷史監控紀錄 |
| MonitoringCategories 資料表 | 監控類別設定 |
| vw_CurrentStatus 視圖 | 目前狀態檢視 |
| sp_MasterHealthCheck 預存程序 | 主健康檢查程序 |
| SQL Agent 作業 | 每小時自動執行健康檢查 |

### 檢視看板

安裝完成後，點擊工具列的 **「看板」** 按鈕，可以看到監控資料。

看板包含五個分頁：

#### 總覽

顯示各監控類型的狀態摘要卡片：

```
┌───────────────┐  ┌───────────────┐  ┌───────────────┐
│ ✓ Memory      │  │ ⚠ Disk        │  │ ✓ CPU         │
│               │  │               │  │               │
│  3    0    0  │  │  1    1    0  │  │  2    0    0  │
│ 正常 警告 危險 │  │ 正常 警告 危險 │  │ 正常 警告 危險 │
└───────────────┘  └───────────────┘  └───────────────┘
```

狀態以顏色標示：

| 圖示 | 狀態 | 說明 |
|------|------|------|
| ✓ 綠色 | OK | 指標正常 |
| ⚠ 黃色 | WARNING | 接近閾值，需注意 |
| ✗ 紅色 | CRITICAL | 超過閾值，需立即處理 |

#### 即時指標

顯示所有監控指標的詳細資料表：

| 類型 | 指標名稱 | 目前值 | 閾值 | 狀態 | 檢查時間 |
|------|----------|--------|------|------|----------|
| Memory | Memory Usage % | 65.3 | 80.0 | OK | 2026-01-25 10:00 |
| Disk | Free Space MB - C: | 15000 | 10000 | OK | 2026-01-25 10:00 |

#### 告警

顯示最近的警告和危險狀態紀錄。可以選擇顯示最近 1、3、7、14 或 30 天的告警。

#### 趨勢

以折線圖顯示指標的歷史趨勢，幫助分析資源使用模式。

1. 從「檢查類型」下拉選單選擇要查看的類型（Memory、CPU、Disk、Connections、TempDB）
2. 從「指標」下拉選單選擇要查看的指標
3. 圖表會顯示最近 30 天的趨勢，虛線為閾值

#### 監控設定

管理各監控類別的設定：

- **啟用/停用**：勾選或取消勾選來啟用或停用該類別
- **檢查間隔**：設定該類別的檢查頻率（分鐘）
- 修改後點擊該列的 **「儲存」** 按鈕套用變更

### 手動執行健康檢查

點擊工具列的 **「執行健康檢查」** 按鈕，可以立即執行一次完整的健康檢查，而不用等待排程執行。

### 移除健康監控系統

如果要移除健康監控系統：

1. 切換到「設定」面板
2. 可選擇以下選項：
   - **保留歷史監控資料**：移除時保留 ServerHealthLog 資料表的資料
   - **只移除 SQL Agent 作業**：只停止自動執行，保留其他物件
3. 點擊 **「移除健康監控系統」** 按鈕

### 權限需求

| 操作 | 需要權限 |
|------|----------|
| 安裝/移除系統 | sysadmin 或 dbcreator |
| 檢視監控資料 | 連線到 DBA 資料庫的權限 |
| 修改監控設定 | DBA 資料庫的寫入權限 |
| 執行健康檢查 | EXECUTE 權限 |

---

## 快捷鍵一覽

| 快捷鍵 | 功能 |
|--------|------|
| **Ctrl+Q** | 開啟 SQL 查詢視窗 |
| **Ctrl+F** | 開啟欄位搜尋視窗 |
| **Ctrl+B** | 開啟備份與還原 |
| **Ctrl+W** | 關閉目前分頁 |
| **Ctrl+T** | 切換深色/淺色主題 |
| **F5** | 執行 SQL 查詢 |

---

## 常見問題

### Q1：無法連線到資料庫？

請檢查以下項目：

1. **伺服器位址**：確認輸入正確，包含執行個體名稱（如 `SERVER\SQLEXPRESS`）
2. **防火牆**：確認 SQL Server 的連接埠（預設 1433）已開放
3. **SQL Server 設定**：確認已啟用 TCP/IP 通訊協定
4. **帳號權限**：確認帳號有權限存取該資料庫

### Q2：無法編輯欄位說明？

可能原因：
- 您的帳號沒有資料庫的寫入權限
- 資料庫設為唯讀模式
- 請聯繫資料庫管理員取得權限

### Q3：匯出 Excel 很慢？

大型資料庫可能需要較長時間，請耐心等待。如果資料庫很大，建議：
- 在離峰時間執行匯出
- 確保電腦有足夠的記憶體

### Q4：批次更新長度失敗？

可能原因：
- 目標長度小於現有資料的最大長度
- 欄位有複雜的約束無法自動處理
- 請檢查錯誤訊息，必要時手動處理

### Q5：如何切換深色模式？

按 **Ctrl+T** 或使用選單 **檢視 → 切換主題** 可以在深色和淺色模式之間切換。

### Q6：連線設定儲存在哪裡？

連線設定儲存在以下位置：

| 作業系統 | 位置 |
|---------|------|
| Windows | `%APPDATA%\TableSpec\connections.json` |
| macOS | `~/.config/TableSpec/connections.json` |
| Linux | `~/.config/TableSpec/connections.json` |

> ⚠️ **注意**：連線設定包含密碼資訊，請妥善保管。

---

## 技術支援

如果您遇到問題或有建議，歡迎透過以下方式聯繫：

- GitHub Issues：[提交問題](https://github.com/KerryHuang/DatabaseDescriptionApp/issues)

---

*TableSpec 使用手冊 v1.0.0*
*最後更新：2026 年 1 月*
